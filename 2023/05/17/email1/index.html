<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  
  <title>å…³äºemailçš„ä¸€åˆ‡(1)-SMTPå‘ä¿¡ | Markity&#39;s Notes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  
    <meta name="author" content="Markity">
  
  
    <meta name="description" content="å‰è¨€:emailæ˜¯å·¥ä½œç”Ÿæ´»ä¸­ç»ä½¿ç”¨çš„é€šè®¯å·¥å…·, ç¬”è€…å¾ˆæ˜¯å¥½å¥‡å®ƒçš„å·¥ä½œåŸç†, æ•…æœ‰æ­¤ç³»åˆ—ã€‚è¿™ä¸ªç³»åˆ—èšç„¦ä»¥ä¸‹å‡ ç‚¹:">
  
  <meta name="description" content="å‰è¨€:emailæ˜¯å·¥ä½œç”Ÿæ´»ä¸­ç»ä½¿ç”¨çš„é€šè®¯å·¥å…·, ç¬”è€…å¾ˆæ˜¯å¥½å¥‡å®ƒçš„å·¥ä½œåŸç†, æ•…æœ‰æ­¤ç³»åˆ—ã€‚è¿™ä¸ªç³»åˆ—èšç„¦ä»¥ä¸‹å‡ ç‚¹:">
<meta property="og:type" content="article">
<meta property="og:title" content="å…³äºemailçš„ä¸€åˆ‡(1)-SMTPå‘ä¿¡">
<meta property="og:url" content="http://example.com/2023/05/17/email1/index.html">
<meta property="og:site_name" content="Markity&#39;s Notes">
<meta property="og:description" content="å‰è¨€:emailæ˜¯å·¥ä½œç”Ÿæ´»ä¸­ç»ä½¿ç”¨çš„é€šè®¯å·¥å…·, ç¬”è€…å¾ˆæ˜¯å¥½å¥‡å®ƒçš„å·¥ä½œåŸç†, æ•…æœ‰æ­¤ç³»åˆ—ã€‚è¿™ä¸ªç³»åˆ—èšç„¦ä»¥ä¸‹å‡ ç‚¹:">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://blog-image-1257452121.cos.ap-chongqing.myqcloud.com/email.png">
<meta property="og:image" content="https://blog-image-1257452121.cos.ap-chongqing.myqcloud.com/email-tls.jpg">
<meta property="og:image" content="https://blog-image-1257452121.cos.ap-chongqing.myqcloud.com/email-mime.png">
<meta property="og:image" content="https://blog-image-1257452121.cos.ap-chongqing.myqcloud.com/email-mime-struct.png">
<meta property="article:published_time" content="2023-05-16T16:57:55.000Z">
<meta property="article:modified_time" content="2023-09-15T15:36:48.000Z">
<meta property="article:author" content="Markity">
<meta property="article:tag" content="æ²¡ç”¨çš„å†·çŸ¥è¯†">
<meta property="article:tag" content="ç½‘ç»œåè®®">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog-image-1257452121.cos.ap-chongqing.myqcloud.com/email.png">
  
    <link rel="alternate" href="/atom.xml" title="Markity&#39;s Notes" type="application/atom+xml">
  
  
    <link rel="icon" type="image/x-icon" href="https://blog-image-1257452121.cos.ap-chongqing.myqcloud.com/avatar.jpg">
  
  
<link rel="stylesheet" href="/css/style.css">

  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div class="wrapper">
    <header id="header">
  <div class="title">
    <h1><a href="/">Markity&#39;s Notes</a></h1>
    <p><a href="/"></a></p>
  </div>
  <nav class="nav">
    <ul>
      
        <li><a href="/">Home</a></li>
      
        <li><a href="/archives">Archives</a></li>
      
      
        <li><a href="/atom.xml">RSS</a></li>
      
    </ul>
    <div class="clearfix"></div>
  </nav>
  <div class="clearfix"></div>
</header>
    <div class="content"><article class="post">
  <header>
    
      <div class="icon"></div>
      <a href="/2023/05/17/email1/">
  <time datetime="2023-05-16T16:57:55.000Z">
    2023-05-17
  </time>
</a>
    
    
  
    <h1 class="title">å…³äºemailçš„ä¸€åˆ‡(1)-SMTPå‘ä¿¡</h1>
  

  </header>
  
  <div class="entry">
    
      <h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€:"></a>å‰è¨€:</h3><p>emailæ˜¯å·¥ä½œç”Ÿæ´»ä¸­ç»ä½¿ç”¨çš„é€šè®¯å·¥å…·, ç¬”è€…å¾ˆæ˜¯å¥½å¥‡å®ƒçš„å·¥ä½œåŸç†, æ•…æœ‰æ­¤ç³»åˆ—ã€‚è¿™ä¸ªç³»åˆ—èšç„¦ä»¥ä¸‹å‡ ç‚¹:</p>
<span id="more"></span>

<ul>
<li>SMTPåè®®</li>
<li>POP3&#x2F;IMAP4åè®®</li>
</ul>
<p>æœ¬æ–‡è®¨è®ºSMTPåè®®, å³å‘ä¿¡åè®®ã€‚POP3åè®®åç»­æ–‡ç« è®¨è®ºã€‚</p>
<h3 id="é‚®ä»¶å‘é€çš„æ•´ä½“æ¶æ„"><a href="#é‚®ä»¶å‘é€çš„æ•´ä½“æ¶æ„" class="headerlink" title="é‚®ä»¶å‘é€çš„æ•´ä½“æ¶æ„"></a>é‚®ä»¶å‘é€çš„æ•´ä½“æ¶æ„</h3><p>å¼€å±€ä¸€å¼ å›¾:</p>
<p><img src="https://blog-image-1257452121.cos.ap-chongqing.myqcloud.com/email.png" alt="é‚®ä»¶æ”¶å‘"></p>
<h3 id="SMTP-netcatåˆä½“éªŒ"><a href="#SMTP-netcatåˆä½“éªŒ" class="headerlink" title="SMTP netcatåˆä½“éªŒ"></a>SMTP netcatåˆä½“éªŒ</h3><p>SMTPå³Simple Mail Transfer Protocol, æ˜¯ç”¨æ¥å‘é‚®ä»¶çš„åè®®ã€‚è¦ä½¿ç”¨å®ƒå¾ˆç®€å•, é¦–å…ˆéœ€è¦tcpè¿æ¥ä¸Šç›¸åº”çš„SMTPæœåŠ¡å™¨, è¿™é‡Œæˆ‘ä»¬ç”¨ncè¿›è¡Œè¿æ¥, (æ­¤å¤„æ³¨æ„åˆ«ç”¨smtp.qq.com, netcatå‘é€çš„å†…å®¹æ˜¯\nç»“å°¾çš„, è€Œqqé‚®ç®±ä¸èƒ½æ¥å—è¿™ç§éæ ‡å‡†çš„å…¼å®¹é€‰é¡¹, å› æ­¤æˆ‘ä»¬é€‰æ‹©gmail):</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt; nc smtp.gmail.com 587</span><br><span class="line">220 smtp.gmail.com ESMTP n8-20020a170902e54800b001a69dfd918dsm13220791plf.187 - gsmtp</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æœåŠ¡ç«¯çš„è¾“å‡ºæ ¼å¼æ˜¯: é”™è¯¯ä»£ç [ç©ºæ ¼]å†…å®¹\r\n, 220æ˜¯Service readyçš„æ„æ€, è¦æŸ¥è¯¢æ›´å¤šé”™è¯¯ä»£ç , å‚é˜…<a target="_blank" rel="noopener" href="https://www.rfc-editor.org/rfc/rfc5321.html">è¿™é‡Œ</a>ã€‚</p>
</blockquote>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦é”®å…¥ehloå¾—åˆ°è¿™ä¸ªé‚®ä»¶æœåŠ¡å™¨çš„å‚æ•°ã€‚å®¢æˆ·ç«¯è¿æ¥ä¸ŠSMTPæœåŠ¡åå…ˆæ‰§è¡Œehloå‘½ä»¤, ä¸ºäº†ä¾¿äºæŸ¥çœ‹è¾“å…¥å’Œè¾“å‡º, æˆ‘ç”¨<code>[]</code>æ¡†ä½äº†ç”¨æˆ·è¾“å…¥:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt; nc smtp.gmail.com 587</span><br><span class="line">220 smtp.gmail.com ESMTP n8-20020a170902e54800b001a69dfd918dsm13220791plf.187 - gsmtp</span><br><span class="line">[ehlo mycom]</span><br><span class="line">250-smtp.gmail.com at your service, [183.230.12.212]</span><br><span class="line">250-SIZE 35882577</span><br><span class="line">250-8BITMIME</span><br><span class="line">250-STARTTLS</span><br><span class="line">250-ENHANCEDSTATUSCODES</span><br><span class="line">250-PIPELINING</span><br><span class="line">250-CHUNKING</span><br><span class="line">250 SMTPUTF8</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ehloå‘½ä»¤åé¢å¯ä»¥è·Ÿä»»ä½•å­—ç¬¦ä¸², æ ‡å‡†è¯´è¿™ä¸ªå­—ç¬¦ä¸²æ˜¯æ ‡è¯†å®¢æˆ·ç«¯èº«ä»½çš„, ä½†æ˜¯å®é™…ä¸Šæ²¡å•¥ç”¨, æŒ‰æƒ¯ä¾‹å¯ä»¥å°†å®ƒè®¾ç½®ä¸ºè®¡ç®—æœºçš„hostnameã€‚æˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°æœ€åä¸€è¡Œæ˜¯250[ç©ºæ ¼]SMTPUTF8, å‰é¢éƒ½æ˜¯250[æ¨ªçº¿]xxx, åªæœ‰æœ€åä¸€è¡Œè¾“å‡ºæ˜¯ç”¨ç©ºæ ¼åˆ†å‰²çš„, å‰é¢çš„éƒ½æ˜¯ç”¨æ¨ªçº¿åˆ†å‰²çš„, è¿™æ˜¯ç”¨äºåˆ¤æ–­æœåŠ¡ç«¯è¾“å‡ºç»“æŸçš„å‡­æ®ã€‚</p>
</blockquote>
<p>æœåŠ¡ç«¯è¯»åˆ°ehloå‘½ä»¤åä¼šå“åº”è‡ªå·±æ”¯æŒçš„é€‰é¡¹, 250æ˜¯å“åº”ä»£ç , ä»£è¡¨Requested mail action okay, completedã€‚ä¸‹é¢è§£é‡Šä¸‹ä¸€äº›é€‰é¡¹:</p>
<ul>
<li>SIZE: é‚®ä»¶æ•°æ®çš„æœ€å¤§å­—èŠ‚æ•°</li>
<li>STARTTLS: ç”±äºæˆ‘ä»¬è¿™é‡Œæ˜¯tcpè£¸è¿æ¥, æ²¡æœ‰ä»»ä½•åŠ å¯†, è¿™ä¸ªé€‰é¡¹ä»£è¡¨æœåŠ¡ç«¯å…è®¸tlsæ¡æ‰‹</li>
</ul>
<blockquote>
<p>åœ¨è¿æ¥åˆ°smtpæœåŠ¡å, å®¢æˆ·ç«¯é¦–å…ˆéœ€è¦ehlo, ç„¶åå¯é€‰åœ°é€‰æ‹©æ˜¯å¦è¿›è¡Œtlsæ¡æ‰‹åŠ å¯†ã€‚qqå‘é‚®ä»¶å¯ä»¥è‡ªè¡Œé€‰æ‹©æ˜¯å¦è¿›è¡Œtls&#x2F;sslåŠ å¯†, ä½†æ˜¯gmailå¼ºåˆ¶è¦æ±‚è¿›è¡Œtlsæ¡æ‰‹ä¹‹åæ‰èƒ½å‘é€, è¿™æ ·å°±ä¸ä¼šè¢«è¿è¥å•†ç›‘å¬åˆ°é‚®ä»¶å†…å®¹ã€‚</p>
</blockquote>
<p>gmailå¼ºè¡Œè¦æ±‚å‘ä¿¡å‰è¿›è¡Œtlsæ¡æ‰‹, å› æ­¤netcatè¿™ä¸ªå°å·¥å…·æ²¡æ³•æ»¡è¶³æˆ‘ä»¬çš„è¦æ±‚, è¦è¿›è¡Œæ¡æ‰‹, ä½¿ç”¨<code>STARTTLS</code>å‘½ä»¤:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">nc smtp.gmail.com 587</span><br><span class="line">220 smtp.gmail.com ESMTP n8-20020a170902e54800b001a69dfd918dsm13220791plf.187 - gsmtp</span><br><span class="line">[ehlo mycom]</span><br><span class="line">250-smtp.gmail.com at your service, [183.230.12.212]</span><br><span class="line">250-SIZE 35882577</span><br><span class="line">250-8BITMIME</span><br><span class="line">250-STARTTLS</span><br><span class="line">250-ENHANCEDSTATUSCODES</span><br><span class="line">250-PIPELINING</span><br><span class="line">250-CHUNKING</span><br><span class="line">250 SMTPUTF8</span><br><span class="line">[STARTTLS]</span><br><span class="line">220 2.0.0 Ready to start TLS</span><br><span class="line">... è¿™é‡Œæˆ‘ä»¬éœ€è¦ç”¨ç¨‹åºè¿›è¡Œtlsåå•†äº†, ç„¶è€Œncæ²¡æ³•æ</span><br></pre></td></tr></table></figure>

<p>å…³äºå‡çº§åˆ°tls, è¿™é‡Œç»™ä¸ªå›¾å§:</p>
<p><img src="https://blog-image-1257452121.cos.ap-chongqing.myqcloud.com/email-tls.jpg" alt="åŠ å¯†å‡çº§ç¤ºæ„å›¾"></p>
<h3 id="ä½¿ç”¨goç¼–å†™çš„ç¨‹åºä¸qq-smtpæœåŠ¡å™¨é€šè®¯"><a href="#ä½¿ç”¨goç¼–å†™çš„ç¨‹åºä¸qq-smtpæœåŠ¡å™¨é€šè®¯" class="headerlink" title="ä½¿ç”¨goç¼–å†™çš„ç¨‹åºä¸qq smtpæœåŠ¡å™¨é€šè®¯"></a>ä½¿ç”¨goç¼–å†™çš„ç¨‹åºä¸qq smtpæœåŠ¡å™¨é€šè®¯</h3><p>ä¹‹å‰æåˆ°ncå‘é€çš„å­—ç¬¦ä¸²æ˜¯ç”¨\nç»“å°¾çš„, qqé‚®ç®±ä¸æ”¯æŒ, å› æ­¤æˆ‘ä»¬è‡ªå·±å†™ä¸ª\r\nç»“å°¾çš„ncç‰ˆæœ¬è¿æ¥qqæœåŠ¡å™¨, å¹¶ç”¨å®ƒå‘é€é‚®ä»¶è¯•è¯•ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;bufio&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;net&quot;</span></span><br><span class="line">	<span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	conn, err := net.Dial(<span class="string">&quot;tcp&quot;</span>, <span class="string">&quot;smtp.qq.com:587&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// conn reader</span></span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">for</span> &#123;</span><br><span class="line">			buf := <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="number">256</span>)</span><br><span class="line">			n, err := conn.Read(buf)</span><br><span class="line">			<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">				<span class="built_in">panic</span>(err)</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			_, err = os.Stdout.Write(buf[:n])</span><br><span class="line">			<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">				<span class="built_in">panic</span>(err)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// stdin reader</span></span><br><span class="line">	scanner := bufio.NewScanner(os.Stdin)</span><br><span class="line">	<span class="keyword">for</span> scanner.Scan() &#123;</span><br><span class="line">		_, err := conn.Write([]<span class="type">byte</span>(fmt.Sprintf(<span class="string">&quot;%s\r\n&quot;</span>, scanner.Text())))</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="built_in">panic</span>(err)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">select</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä¸ºä»€ä¹ˆæˆ‘ä»¬åˆåˆ‡æ¢åˆ°äº†qqé‚®ç®±? å› ä¸ºgmailå‘é‚®ä»¶å¼ºåˆ¶è¦æ±‚å…ˆehloåstarttls, æˆ‘ä¸æƒ³è¿›è¡Œtlsæ¡æ‰‹(å†™ä»£ç å¤ªéº»çƒ¦äº†)ã€‚å› æ­¤æˆ‘ä»¬ç”¨qqé‚®ç®±æ¥åš, å®ƒä¸å¼ºåˆ¶è¦æ±‚ä½¿ç”¨tlsé€šè®¯ã€‚</p>
</blockquote>
<p>ä¸‹é¢æˆ‘ä»¬ä½¿ç”¨AUTH LOGINå‘½ä»¤è¿›è¡Œèº«ä»½è®¤è¯:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">echo</span> -n <span class="string">&quot;1494645263@qq.com&quot;</span> | <span class="built_in">base64</span></span><br><span class="line">MTQ5NDY0NTI2M0BxcS5jb20=</span><br><span class="line">&gt; <span class="built_in">echo</span> -n <span class="string">&quot;ä½ ä»qqé‚®ç®±è®¾ç½®ä¸­æ‹¿åˆ°çš„æˆæƒç &quot;</span> | <span class="built_in">base64</span></span><br><span class="line">cXJjY2xxxxxxxmVxYmFkYg==</span><br><span class="line">&gt; go run .</span><br><span class="line">220 newxmesmtplogicsvrszc2-1.qq.com XMail Esmtp QQ Mail Server.</span><br><span class="line">[EHLO mycom]</span><br><span class="line">250-newxmesmtplogicsvrsza12-0.qq.com</span><br><span class="line">250-PIPELINING</span><br><span class="line">250-SIZE 73400320</span><br><span class="line">250-STARTTLS</span><br><span class="line">250-AUTH LOGIN PLAIN XOAUTH XOAUTH2</span><br><span class="line">250-AUTH=LOGIN</span><br><span class="line">250-MAILCOMPRESS</span><br><span class="line">250 8BITMIME</span><br><span class="line">[AUTH LOGIN]</span><br><span class="line">334 VXNlcm5hbWU6</span><br><span class="line">[MTQ5NDY0NTI2M0BxcS5jb20=]</span><br><span class="line">334 UGFzc3dvcmQ6</span><br><span class="line">[cXJjY2xxxxxxxmVxYmFkYg==]</span><br><span class="line">235 Authentication successful</span><br></pre></td></tr></table></figure>

<blockquote>
<p>VXNlcm5hbWU6è¿›è¡Œbase64è§£ç åå°±æ˜¯<code>Username:</code>, UGFzc3dvcmQ6åˆ™æ˜¯<code>Password:</code>, è¦base64è§£ç å¯ä»¥ç”¨åˆ°<code>echo -n &quot;VXNlcm5hbWU6&quot; | base64 -d</code>è¯å®ã€‚</p>
</blockquote>
<p>ç„¶åå°±èƒ½è¿›è¡Œå‘ä¿¡æ“ä½œäº†, æˆ‘ä»¬ä»ä¸Šé¢çš„<code>235 Authentication successful</code>å¤„ç»§ç»­:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">235 Authentication successful</span><br><span class="line">[MAIL FROM:&lt;1494645263@qq.com&gt;]</span><br><span class="line">250 OK</span><br><span class="line">[RCPT TO:&lt;3402002560@qq.com&gt;]</span><br><span class="line">250 OK</span><br><span class="line">[DATA]</span><br><span class="line">354 End data with &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;.</span><br><span class="line">[Subject: Hello World]</span><br><span class="line">[From: æ—­æ—­ç§‘æŠ€ &lt;1494645263@qq.com&gt;]	// è¿™é‡Œå…è®¸ç½²åä¸€ä¸‹, æ¥æ”¶è€…èƒ½çœ‹åˆ°æˆ‘ä»¬çš„ç½²å, ä½†ä¹Ÿå…è®¸ä¸ç½²å From: &lt;xxx@qq.com&gt; å°±æ˜¯ä¸ç½²åçš„æƒ…å†µ</span><br><span class="line">[To: &lt;3402002560@qq.com&gt;]			   // Toä¹Ÿèƒ½ç½²å, è¿™é‡Œä¸ç½²</span><br><span class="line">[]                                     // æ³¨æ„è¿™æ˜¯ä¸€ä¸ªç©ºè¡Œ</span><br><span class="line">[Hello World]</span><br><span class="line">[.]</span><br><span class="line">[]                                     // æ³¨æ„è¿™æ˜¯ä¸€ä¸ªç©ºè¡Œ</span><br><span class="line">250 OK: queued as.</span><br></pre></td></tr></table></figure>

<p>ç„¶åæˆ‘ä»¬å°±èƒ½æ”¶åˆ°Hello Worldçš„è®¯æ¯äº†, æ˜¯ä¸æ˜¯å¾ˆç®€å•ğŸ˜ƒã€‚</p>
<p>å¦‚æœæˆ‘ä»¬è¦å¤ç”¨è¿™ä¸ªè¿æ¥, è¦ç”¨å®ƒå‘é€å¤šä¸ªè®¯æ¯, è¿™æ—¶ä½¿ç”¨RSETå‘½ä»¤æ¸…ç©ºä¹‹å‰çš„ç¼“å­˜, è¿™ä¼šæ¸…ç©ºä¹‹å‰çš„<code>MAIL FROM</code>, <code>RCPT TO</code>å‘½ä»¤ã€‚<code>RSET</code>åå°±èƒ½é‡æ–°è¿›è¡Œå‘é€é‚®ä»¶æ“ä½œäº†ã€‚</p>
<p>æœ€å, è¦é€€å‡º, ä½¿ç”¨<code>QUIT</code>å‘½ä»¤, æœåŠ¡ç«¯å“åº”221 Service closing transmission channelåä¼šclose socket:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[QUIT]</span><br><span class="line">221 Bye.</span><br></pre></td></tr></table></figure>

<h3 id="å…³äºæŠ„é€å’Œå¯†é€"><a href="#å…³äºæŠ„é€å’Œå¯†é€" class="headerlink" title="å…³äºæŠ„é€å’Œå¯†é€"></a>å…³äºæŠ„é€å’Œå¯†é€</h3><p>ä¸€å°é‚®ä»¶å¯ä»¥å‘ç»™å¤šä¸ªäºº, æˆ‘ä»¬å¯ä»¥é€šè¿‡å¤šæ¬¡<code>RCPT</code>å‘½ä»¤å®ç°ã€‚ä»¥å‰æˆ‘è¿˜ä»¥ä¸ºä¸€å°é‚®ä»¶åªèƒ½æœ‰ä¸€ä¸ªæ”¶ä¿¡äºº, çœ‹æ¥æˆ‘å¯¹emailçš„è®¤çŸ¥è¿˜æ˜¯å¤ªå°‘äº†ğŸ˜…ã€‚</p>
<p>æ­¤å¤–, ä¸€å°é‚®ä»¶ä¹Ÿèƒ½æŠ„é€ç»™å¤šä¸ªäºº, æ¯”å¦‚æˆ‘ä»¬é‚®ä»¶å‘é€ç»™äº†Bobå¹¶æŠ„é€ç»™äº†Alice, Bobå’ŒAliceéƒ½èƒ½æ”¶åˆ°è¿™å°é‚®ä»¶, å¹¶ä¸”Bobå’ŒAliceéƒ½çŸ¥é“æ­¤é‚®ä»¶çš„æ¥æ”¶è€…æ˜¯Bob, ä¹Ÿéƒ½çŸ¥é“è¿™å°é‚®ä»¶è¢«æŠ„é€ç»™äº†Aliceã€‚é‚£ä¹ˆè¿™ä¸ªåŠŸèƒ½æœ‰å•¥ç”¨å‘¢, æˆ‘è®¤ä¸ºå®ƒæ˜¯ç”¨æ¥åŒºåˆ†æ”¶ä¿¡è€…ä¸æ—è¾¹è€…çš„ä¸€ä¸ªå‡­æ®, å¼ºè°ƒæ¥æ”¶æ–¹æ˜¯Bobè€Œå·²ã€‚</p>
<p>ä¸€å°é‚®ä»¶ä¹Ÿèƒ½å¯†é€ç»™å¤šä¸ªäºº, åŒºåˆ«å°±åœ¨å¯†é€çš„å¯¹è±¡ä¸ä¼šå…¬å¼€ç»™å…¶ä»–äºº, æ¯”å¦‚æˆ‘ä»¬å‘é€é‚®ä»¶ç»™Bobå¹¶å¯†é€ç»™Alice, Bobå’ŒAliceéƒ½èƒ½æ”¶åˆ°è¿™å°é‚®ä»¶, ä½†æ˜¯Bobå´ä¸çŸ¥é“è¿™å°é‚®ä»¶å¯†é€ç»™äº†Alice, è€ŒAliceçŸ¥é“è¿™å°é‚®ä»¶æ¥è‡ªæˆ‘, å‘é€ç»™Bobã€‚å¯†é€å¾ˆé€‚åˆæ‰“å°æŠ¥å‘Šã€‚</p>
<p>å¦‚æœè¦å‘ç»™Bob(<a href="mailto:&#x31;&#49;&#48;&#64;&#x71;&#x71;&#x2e;&#x63;&#111;&#109;">&#x31;&#49;&#48;&#64;&#x71;&#x71;&#x2e;&#x63;&#111;&#109;</a>), å¹¶æŠ„é€ç»™Alice(<a href="mailto:&#50;&#x32;&#48;&#64;&#113;&#x71;&#46;&#99;&#111;&#x6d;">&#50;&#x32;&#48;&#64;&#113;&#x71;&#46;&#99;&#111;&#x6d;</a>)é‚£ä¹ˆè¿™æ ·åš:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[MAIL FROM:&lt;1494645263@qq.com&gt;]</span><br><span class="line">250 OK</span><br><span class="line">[RCPT TO:&lt;110@qq.com&gt;]</span><br><span class="line">250 OK</span><br><span class="line">[RCPT TO:&lt;220@qq.com&gt;]</span><br><span class="line">220 OK</span><br><span class="line">[DATA]</span><br><span class="line">354 End data with &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;.</span><br><span class="line">[Subject: Hello World]</span><br><span class="line">[From: æ—­æ—­ç§‘æŠ€ &lt;1494645263@qq.com&gt;]</span><br><span class="line">[To: &lt;110@qq.com&gt;]</span><br><span class="line">[Bcc: &lt;220@qq.com&gt;]</span><br><span class="line">[]							// è¿™æ˜¯ç©ºè¡Œ</span><br><span class="line">[Hello World]</span><br><span class="line">[.]</span><br><span class="line">[]							// è¿™æ˜¯ç©ºè¡Œ</span><br><span class="line">250 OK: queued as.</span><br></pre></td></tr></table></figure>

<p>ç„¶åBobæ”¶åˆ°çš„é‚®ä»¶å°±èƒ½çœ‹åˆ°å‘ä¿¡äººæ˜¯<a href="mailto:&#49;&#x34;&#x39;&#52;&#x36;&#52;&#53;&#50;&#54;&#51;&#x40;&#x71;&#113;&#46;&#99;&#111;&#109;">&#49;&#x34;&#x39;&#52;&#x36;&#52;&#53;&#50;&#54;&#51;&#x40;&#x71;&#113;&#46;&#99;&#111;&#109;</a>, ä½†ä»–çœ‹ä¸åˆ°å¯†é€ç»™äº†Aliceã€‚Aliceæ”¶åˆ°çš„é‚®ä»¶èƒ½çœ‹åˆ°å‘ä¿¡äººæ˜¯æˆ‘, æ”¶ä¿¡äººæ˜¯Bob, å¯†é€ç»™äº†Aliceã€‚</p>
<blockquote>
<p>å¦‚æœä¸€å°é‚®ä»¶è¢«å¯†é€ç»™äº†A, B, Cä¸‰ä¸ªäºº, Aä¸ä¼šçŸ¥é“è¿™å°é‚®ä»¶è¢«å¯†é€ç»™äº†Bå’ŒCã€‚å¯†é€æ˜¯å¾ˆéšç§˜çš„, å®ƒå°±æ˜¯ç”¨æ¥æ‰“å°æŠ¥å‘Šçš„ã€‚</p>
</blockquote>
<p>ä½¿ç”¨smtpå‘é€é‚®ä»¶çš„æ—¶å€™, é‚®ä»¶ä¹Ÿè®¸ä¸ä¼šä¿å­˜åœ¨â€œå·²å‘é€â€é‡Œé¢, å¦‚æœæƒ³è¦çŸ¥é“è‡ªå·±çš„ç¨‹åºå‘äº†ä»€ä¹ˆ, åœ¨qqé‚®ç®±çš„è®¾ç½®-&gt;è´¦æˆ·ä¸­å‹¾é€‰ä¸Šâ€œSMTPå‘ä¿¡åä¿å­˜åˆ°æœåŠ¡å™¨â€ã€‚</p>
<h3 id="dataçš„çš„æ ¼å¼-mime"><a href="#dataçš„çš„æ ¼å¼-mime" class="headerlink" title="dataçš„çš„æ ¼å¼: mime"></a>dataçš„çš„æ ¼å¼: mime</h3><p>ä¹‹å‰æˆ‘ä»¬dataçš„æ­£æ–‡åªæ˜¯â€œHello Worldâ€å‡ ä¸ªå­—ç¬¦, å®é™…ä¸Šä½¿ç”¨MIME(Multipurpose Internet Mail Extensions), å¯ä»¥åŒ…å«å¤šç§å¤šæ ·çš„åª’ä½“æ ¼å¼ã€‚</p>
<p><img src="https://blog-image-1257452121.cos.ap-chongqing.myqcloud.com/email-mime.png" alt="dataçš„ç»“æ„"></p>
<blockquote>
<p>è¿™é‡Œè¯·æ³¨æ„, MIME-Versionæ˜¯ä¸ªå…¼å®¹æ€§é€‰é¡¹, ä½†æ˜¯ç›´åˆ°ä»Šå¤©å®ƒè¿˜æ˜¯1.0, å› æ­¤æˆ‘ä»¬å¯ä»¥è®¤ä¸ºå®ƒæ°¸è¿œéƒ½æ˜¯1.0ã€‚</p>
</blockquote>
<p>mimeæ¶ˆæ¯åŒ…å«mime headerå’Œmime body, mime bodyåˆåˆ†ä¸ºäº†body headerå’Œbody payloadã€‚boundaryæ˜¯ä¸€ä¸²éšæœºçš„å­—ç¬¦ä¸², ç”¨äºæ”¾åœ¨bodyä¹‹é—´åšåˆ†å‰²ã€‚</p>
<p>é‚®ä»¶çš„mimeæ˜¯å¤šçº§çš„å†…åµŒç»“æ„:</p>
<p><img src="https://blog-image-1257452121.cos.ap-chongqing.myqcloud.com/email-mime-struct.png" alt="å¤šçº§çš„å†…åµŒç»“æ„"></p>
<p>ä¸¾ä¸ªä¾‹å­, å¦‚æœæˆ‘ä»¬è¦å‘é€ä¸€ä¸²æ–‡å­—, å¹¶ä¸”åŒ…å«ä¸€ä¸ªå›¾ç‰‡é™„ä»¶, é‚£ä¹ˆdataå°±å¤§æ¦‚æ˜¯è¿™æ ·çš„(ä¸èƒ½è¿›è¡Œç¼©è¿›, ä½†æ˜¯ä¸ºäº†å¯è¯»æ€§, æˆ‘æ‰‹åŠ¨è¿›è¡Œäº†ç¼©è¿›):</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">From: from@qq.com</span><br><span class="line">To: dest@qq.com</span><br><span class="line">Subject: æµ‹è¯•é‚®ä»¶</span><br><span class="line">Content-Type: multipart/mixed; boundary&quot;X_NextPart_A&quot;</span><br><span class="line"></span><br><span class="line">This is a multi-part message in MIME format</span><br><span class="line"></span><br><span class="line">--X_NextPart_A</span><br><span class="line">	Content-Type: multipart/alternative; boundary=&quot;X_NextPart_B&quot;;</span><br><span class="line">	--X_NextPart_B</span><br><span class="line">		Content-Type: text/plain; charset=&quot;utf-8&quot;</span><br><span class="line">		Content-Transfer-Encoding: base64</span><br><span class="line"></span><br><span class="line">		ä¸€ä¸²æ–‡æœ¬çš„base64ç¼–ç , èƒ½å¤Ÿé€šè¿‡cid:éšæœºçš„id.jpgå¼•ç”¨é™„ä»¶çš„çœŸå®url</span><br><span class="line"></span><br><span class="line">	--X_NextPart_B</span><br><span class="line">		Content-Type: text/html; charset=&quot;utf-8&quot;</span><br><span class="line">		Content-Transfer-Encoding: base64</span><br><span class="line"></span><br><span class="line">		ä¸€ä¸²æ–‡æœ¬çš„html, èƒ½å¤Ÿé€šè¿‡cid:éšæœºçš„id.jpgå¼•ç”¨é™„ä»¶çš„çœŸå®url</span><br><span class="line"></span><br><span class="line">	--X_NextPart_B</span><br><span class="line"></span><br><span class="line">--X_NextPart_A</span><br><span class="line">	Content-Type: image/jpeg;</span><br><span class="line">	Content-Disposition: attachment; filename=&quot;avatar.jpg&quot;</span><br><span class="line">	Content-ID: &lt;éšæœºçš„id.jpg&gt;</span><br><span class="line">	Content-Transfer-Encoding: base64</span><br><span class="line"></span><br><span class="line">	å›¾ç‰‡çš„base64ç¼–ç </span><br><span class="line"></span><br><span class="line">--X_NextPart_A</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å…·ä½“çš„å†…å®¹å¯ä»¥æŒ‡å®šç¼–ç , base64æ˜¯å¸¸è§çš„ç¼–ç , ä½¿ç”¨è¿™ç§ç¼–ç çš„åŸå› æ˜¯å®ƒèƒ½æŠŠç‰¹æ®Šç¬¦å·è½¬åŒ–æˆå¸¸è§çš„ç¬¦å·, ä¸ä¼šä¸åˆ†å‰²å­—ç¬¦ä¸²å†²çªã€‚æ­¤å¤„, æˆ‘ä»¬è§„å®šäº†ä¸€ä¸ªé™„ä»¶, å®ƒä¸‹è½½ä¸‹æ¥çš„æ–‡ä»¶åæ˜¯avatar.jpgã€‚Content-Disposition: attachmentä»£è¡¨å®ƒæ˜¯é™„ä»¶ã€‚Content-IDå¯ä»¥æŒ‡å®šå®ƒçš„å¼•ç”¨åˆ«å, å¯ä»¥åœ¨å…¶å®ƒåœ°æ–¹ä½¿ç”¨cid:éšæœºçš„id.jpgå°†å…¶æ›¿æ¢æˆå›¾ç‰‡çš„çœŸå®urlã€‚</p>
</blockquote>
<p><code>multipart/alternative</code>çš„è¯­ä¹‰æ˜¯: å…¶ä¸­å†…åµŒçš„å¤šæ¡å†…å®¹éƒ½èƒ½ç­‰ä»·åœ°æ›¿æ¢ã€‚é‚®ä»¶å®¢æˆ·ç«¯åªèƒ½åœ¨é‡Œé¢é€‰æ‹©å…¶ä¸­ä¹‹ä¸€è¿›è¡Œå±•ç¤ºã€‚</p>
<p>ç½‘ç»œä¸­å¸¸è§é‚®ä»¶æ²¡æœ‰é™„ä»¶, å›¾ç‰‡ä¹Ÿæ˜¯ä»ç¬¬ä¸‰æ–¹é“¾æ¥å¼•è¿‡æ¥çš„(å¹¶ä½¿ç”¨htmlçš„imgæ ‡ç­¾æ˜¾ç¤º), è¿™æ—¶mime headerä¸€èˆ¬éƒ½ä¸æ˜¯mixed, å®ƒä¸€èˆ¬å°±æ˜¯alternativeçš„ã€‚</p>
<p>ä¸€èˆ¬é‚®ä»¶çš„alternativeåŒ…å«ä¸¤ç§å†…å®¹, ä¸€ç§æ˜¯html, ä¸€ç§æ˜¯plainã€‚æœ‰çš„è®¾å¤‡å¹¶ä¸èƒ½è¯»å–htmlçš„å†…å®¹, å› æ­¤å¯ä»¥é€‰æ‹©å±•ç¤ºplainçš„å†…å®¹ã€‚å¤§å¤šæ•°é‚®ä»¶éƒ½ä¼šç”Ÿæˆhtmlå’Œplainä¸¤ç§å¯æ›¿ä»£å†…å®¹, æé«˜é‚®ä»¶çš„æ™®é€‚æ€§ã€‚</p>
<p>ä¸‹é¢å°±æ˜¯ç½‘ç»œä¸­å¸¸è§é‚®ä»¶çš„æ ¼å¼, æˆ‘ä»¬åœ¨ç½‘ç»œä¸Šæ”¶åˆ°çš„å›¾ç‰‡ä¸€èˆ¬éƒ½æ˜¯è¿™æ ·çš„, ä¸åŒ…å«é™„ä»¶, ä¹Ÿæ²¡æœ‰å†…åµŒå›¾ç‰‡, å¦‚æœè¦æ˜¾ç¤ºå›¾ç‰‡, ä¸€èˆ¬éƒ½æ˜¯å¼•ç”¨çš„å¤–é“¾:</p>
<p>å®ƒæœ‰è¿™æ ·çš„åˆ†å±‚ç»“æ„:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alternative</span><br><span class="line">	text/plain</span><br><span class="line">	text/html</span><br></pre></td></tr></table></figure>

<p>ä¸¾ä¸ªä¾‹å­:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">From: from@qq.com</span><br><span class="line">To: dest@qq.com</span><br><span class="line">Subject: æµ‹è¯•é‚®ä»¶</span><br><span class="line">Content-Type: multipart/alternative; boundary=&quot;X_NextPart_A&quot;</span><br><span class="line"></span><br><span class="line">This is a multi-part message in MIME format</span><br><span class="line"></span><br><span class="line">--X_NextPart_A</span><br><span class="line">	Content-Type: text/plain; charset=&quot;utf-8&quot;</span><br><span class="line">	Content-Transfer-Encoding: base64</span><br><span class="line"></span><br><span class="line">	ä¸€ä¸²æ–‡æœ¬çš„base64ç¼–ç , ä¸èƒ½æ˜¾ç¤ºå›¾ç‰‡</span><br><span class="line"></span><br><span class="line">--X_NextPart_A</span><br><span class="line">	Content-Type: text/html; charset=&quot;utf-8&quot;</span><br><span class="line">	Content-Transfer-Encoding: base64</span><br><span class="line"></span><br><span class="line">	ä¸€ä¸²æ–‡æœ¬çš„html, å¯ä»¥ç”¨&lt;img&gt;æ ‡ç­¾, src=å¤–éƒ¨é“¾æ¥å¼•å…¥å¤–éƒ¨çš„å›¾ç‰‡</span><br><span class="line"></span><br><span class="line">--X_NextPart_A</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¸¸è§çš„é‚®ä»¶ä¸€èˆ¬åªåŒ…å«æ–‡å­—å’Œå›¾ç‰‡, å®ƒä¸€èˆ¬ä¸ä¼šæŠŠå›¾ç‰‡çš„äºŒè¿›åˆ¶æ•°æ®å‘é€ç»™é‚®ä»¶æœåŠ¡å™¨, è€Œæ˜¯ç›´æ¥å¼•ç¬¬ä¸‰æ–¹çš„å›¾ç‰‡, å›¾ç‰‡å¯ä»¥æ”¾åœ¨å›¾åºŠæˆ–å¯¹è±¡å­˜å‚¨é‡Œè¾¹, ä¸Šä¼ å›¾ç‰‡çš„äºŒè¿›åˆ¶æˆæœ¬å¤ªé«˜ã€‚</p>
</blockquote>
<p>ä¸‹é¢æ˜¯é‚®ä»¶çš„ä¸€èˆ¬éœ€æ±‚, å…¶åˆ†å±‚ç»“æ„å¦‚ä¸‹:</p>
<p>éœ€æ±‚1(æœ€å¤æ‚çš„æƒ…å½¢):</p>
<ol>
<li>å…·æœ‰æ–‡æœ¬å’Œhtmlç‰ˆæœ¬</li>
<li>å…·æœ‰å†…åµŒçš„å›¾ç‰‡</li>
<li>å…·æœ‰é™„ä»¶</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">multipart/mixed</span><br><span class="line">    multipart/alternative</span><br><span class="line">        text/plain</span><br><span class="line">        multipart/related</span><br><span class="line">            text/html</span><br><span class="line">            inline image</span><br><span class="line">    attachment</span><br></pre></td></tr></table></figure>

<p>ä¾‹å­:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">From: from@qq.com</span><br><span class="line">To: dest@qq.com</span><br><span class="line">Subject: æµ‹è¯•é‚®ä»¶</span><br><span class="line">Content-Type: multipart/mixed; boundary=&quot;X_NextPart_A&quot;</span><br><span class="line"></span><br><span class="line">This is a multi-part message in MIME format</span><br><span class="line"></span><br><span class="line">--X_NextPart_A</span><br><span class="line">	Content-Type: multipart/alternative; boundary=&quot;X_NextPart_B&quot;</span><br><span class="line"></span><br><span class="line">	--X_NextPart_B</span><br><span class="line">		Content-Type: text/plain; charset=&quot;utf-8&quot;</span><br><span class="line">		Content-Transfer-Encoding: base64</span><br><span class="line"></span><br><span class="line">		æ–‡å­—çš„base64ç¼–ç , èƒ½å¤Ÿé€šè¿‡cid:éšæœºçš„id2.jpgå¼•ç”¨å›¾ç‰‡çš„çœŸå®url</span><br><span class="line"></span><br><span class="line">	--X_NextPart_B</span><br><span class="line">	Content-Type: multipart/related; boundary=&quot;X_NextPart_C&quot;</span><br><span class="line">		--X_NextPart_C</span><br><span class="line">			Content-Type: text/html; charset=&quot;utf-8&quot;</span><br><span class="line">			Content-Transfer-Encoding: base64</span><br><span class="line"></span><br><span class="line">			htmlå†…å®¹çš„base64ç¼–ç , èƒ½å¤Ÿé€šè¿‡cid:éšæœºçš„id1.jpgæˆ–cid:éšæœºçš„id2.jpgå¼•ç”¨å›¾ç‰‡çš„çœŸå®url</span><br><span class="line"></span><br><span class="line">		--X_NextPart_C</span><br><span class="line">			Content-Type: image/jpeg;</span><br><span class="line">			Content-Disposition: inline;</span><br><span class="line">			Content-ID: &lt;éšæœºçš„id1.jpg&gt;</span><br><span class="line">			Content-Transfer-Encoding: base64</span><br><span class="line"></span><br><span class="line">			å›¾ç‰‡1çš„base64</span><br><span class="line"></span><br><span class="line">		--X_NextPart_C</span><br><span class="line"></span><br><span class="line">	htmlçš„base64ç¼–ç </span><br><span class="line"></span><br><span class="line">	--X_NextPart_B</span><br><span class="line"></span><br><span class="line">--X_NextPart_A</span><br><span class="line">	Content-Type: image/jpeg;</span><br><span class="line">	Content-Disposition: inline;</span><br><span class="line">	Content-ID: &lt;éšæœºçš„id2.jpg&gt;</span><br><span class="line">	Content-Transfer-Encoding: base64</span><br><span class="line"></span><br><span class="line">	å›¾ç‰‡2çš„base64</span><br><span class="line"></span><br><span class="line">--X_NextPart_A</span><br></pre></td></tr></table></figure>

<p>éœ€æ±‚2(ç½‘ç»œé‚®ä»¶æœ€å¸¸è§çš„å½¢å¼):</p>
<ol>
<li>å…·æœ‰æ–‡æœ¬å’Œhtmlç‰ˆæœ¬</li>
<li>æ²¡æœ‰å†…åµŒå›¾ç‰‡å’Œé™„ä»¶</li>
<li>å›¾ç‰‡æ˜¯å¼•ç”¨çš„å¤–é“¾</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">multipart/alternative</span><br><span class="line">	text/plain</span><br><span class="line">	text/html</span><br></pre></td></tr></table></figure>

<p>éœ€æ±‚3:</p>
<ol>
<li>å…·æœ‰æ–‡æœ¬å’Œhtmlç‰ˆæœ¬</li>
<li>åªæœ‰å†…åµŒå›¾ç‰‡, æ²¡æœ‰é™„ä»¶</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">multipart/alternative</span><br><span class="line">	text/plain</span><br><span class="line">	multipart/related</span><br><span class="line">		text/html</span><br><span class="line">		inline image</span><br><span class="line">		inline image</span><br></pre></td></tr></table></figure>

<p>éœ€æ±‚4:</p>
<ol>
<li>å…·æœ‰æ–‡æœ¬å’Œhtmlç‰ˆæœ¬</li>
<li>æœ‰é™„ä»¶, æ²¡æœ‰å†…åµŒå›¾ç‰‡</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">multipart/mixed</span><br><span class="line">	multipart/alternative</span><br><span class="line">		text/plain</span><br><span class="line">		text/html</span><br><span class="line">	attachment</span><br></pre></td></tr></table></figure>

<p>ç›¸å…³å‚è€ƒæ¥è‡ª<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/3902455/mail-multipart-alternative-vs-multipart-mixed">è¿™é‡Œ</a>ã€‚</p>
<h3 id="SMTPåè®®æ€»ç»“"><a href="#SMTPåè®®æ€»ç»“" class="headerlink" title="SMTPåè®®æ€»ç»“"></a>SMTPåè®®æ€»ç»“</h3><p>åè®®æœ¬èº«ä¸å¤æ‚, å¤æ‚çš„æ˜¯mimeæ¶ˆæ¯æ•°æ®çš„è§„åˆ™ã€‚ä¸Šé¢æåˆ°çš„æç¤ºå°±æ˜¯smtpçš„æ‰€æœ‰ä¸»å¹²éƒ¨åˆ†äº†, ä¸‹é¢åˆ—ä¸¾ä¸€äº›å…¶å®ƒçš„å‘½ä»¤:</p>
<ul>
<li>HELO: åŒEHLO, ä½†æ˜¯EHLOæ˜¯HELOçš„è¶…é›†, å®ƒè¿”å›äº†é‚®ä»¶æœåŠ¡å™¨çš„æ›´å¤šæ‹“å±•å‚æ•°, ä¸€èˆ¬ä¸ç”¨HELOã€‚</li>
<li>VRFY: æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦å­˜åœ¨æ­¤é‚®ç®±è´¦å·, è¿™ä¸ªé€‰é¡¹ä¸€èˆ¬ä¸è¢«é‚®ç®±æœåŠ¡å™¨æ”¯æŒ, ä¸è®ºæ˜¯gmailè¿˜æ˜¯qqéƒ½æ²¡æœ‰æ”¯æŒã€‚è¿™æ˜¯ä¸ºäº†å®‰å…¨ã€‚</li>
<li>NOOP: è¿™ä¸ªå‘½ä»¤å¯ä»¥ç”¨äºå¿ƒè·³æ£€æµ‹, å¯¹ç«¯æ€»æ˜¯å›åº”250é”™è¯¯ç , å¯ä»¥ç”¨æ¥ä¿æ´»ã€‚</li>
</ul>
<p>æ­¤å¤–, å¦‚æœæˆ‘ä»¬ç”¨smtpåè®®å‘é‚®ä»¶, å¦‚æœåœ¨dataå‘½ä»¤åå‘å†…å®¹ä¸­é€”å‡ºç°äº†socketé”™è¯¯, æ­¤æ—¶æˆ‘ä»¬æ— æ³•æ–­å®šé‚®ä»¶æ˜¯å¦å‘å‡ºã€‚å¦‚æœç¨‹åºé€‰æ‹©é‡è¿smtpæœåŠ¡å™¨å¹¶é‡æ–°å‘é€, å¯èƒ½å¯¼è‡´åŒæ ·çš„é‚®ä»¶è¢«å‘å‡ºä¸¤æ¬¡ã€‚è¿™æ˜¯ä¸å¯é¿å…çš„ã€‚smtpåè®®æ˜¯ç®€å•çš„, æ²¡æ³•é¢„é˜²è¿™ç§é‡æ”¾é—®é¢˜ã€‚å¦‚æœè¦è§£å†³, æˆ‘çš„æƒ³æ³•æ˜¯å®ç°ä¸€ä¸ªæ›´ç‰›çš„åè®®, åšä¸€ä¸ªäºŒé˜¶æ®µæäº¤ã€‚ä½†æ˜¯è¿™ä¸æ˜¯åˆšéœ€, ä¸€ä¸ªé‚®ä»¶è¢«å‘ä¸¤æ¬¡ä¹Ÿä¸æ˜¯ä»€ä¹ˆå¤§é”™, å› æ­¤smtpé€‰æ‹©å¿½è§†è¿™ä¸ªé—®é¢˜ã€‚</p>
<h3 id="å‘é€ä¹‹å"><a href="#å‘é€ä¹‹å" class="headerlink" title="å‘é€ä¹‹å?"></a>å‘é€ä¹‹å?</h3><p>é‚®ä»¶é€’äº¤ç»™é‚®ç®±æœåŠ¡å™¨å, ç”±é‚®ä»¶æœåŠ¡å™¨é€’äº¤ç»™å¦å¤–ä¸€ä¸ªé‚®ä»¶æœåŠ¡å™¨çš„è¿‡ç¨‹å«relayingã€‚æ­¤æ—¶é‚®ä»¶æœåŠ¡å™¨æ”¶åˆ°é‚®ä»¶åä¼šå°½æœ€å¤§åŠªåŠ›å‘å‡ºã€‚ä½†æ˜¯å¦‚æœå‘ä¸å‡º, æ¯”å¦‚ç½‘ç»œé—®é¢˜æˆ–è€…æ ¹æœ¬æ²¡æœ‰è¿™ä¸ªé‚®ç®±, é‚®ä»¶å°±ä¼šè¢«â€œé€€å›â€ã€‚</p>
<h3 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h3><ul>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/3902455/mail-multipart-alternative-vs-multipart-mixed">å…³äºmultipart&#x2F;mixed, multipart&#x2F;relatedå’Œmultipart&#x2F;alternative</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/522806299">smtpç®€æ</a></li>
</ul>

    
  </div>
  <footer>
    
      
      
  <div class="tags">
    <a class="tags-none-link" href="/tags/%E6%B2%A1%E7%94%A8%E7%9A%84%E5%86%B7%E7%9F%A5%E8%AF%86/" rel="tag">æ²¡ç”¨çš„å†·çŸ¥è¯†</a>, <a class="tags-none-link" href="/tags/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/" rel="tag">ç½‘ç»œåè®®</a>
  </div>

    
    <div class="clearfix"></div>
  </footer>
</article>

</div>
  </div>
  <footer id="footer"><div class="copyright">
  
  &copy; 2024 <a href="/">Markity</a>
  
</div>
<div class="theme-copyright">
  Theme by <a href="https://github.com/orderedlist" target="_blank">orderedlist</a>
   | 
  Redesign by <a href="http://heroicyang.com/" target="_blank">Heroic Yang</a>
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
<script src="/js/scale.fix.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
  (function($){
    $('.fancybox').fancybox();
  })(jQuery);
</script>

</body>
</html>